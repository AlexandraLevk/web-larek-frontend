# Проектная работа "Веб-ларек"

Реализация интернет-магазина с товарами для веб-разработчиков — Web-ларёк. В нём можно посмотреть каталог товаров, добавить товары в корзину и сделать заказ.

* Стек: HTML, SCSS, TS, Webpack

## Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

## Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```


## Данные и типы данных, используемые в приложении

Категории товаров
```
type ProductCategory = 'софт-скил' | 'другое' | 'дополнительное' | 'кнопка' | 'хард-скил';
```

Способы оплаты
```
type PaymentMethod = 'онлайн' | 'при получении';
```

Товар
```
interface IItem {
  id: string;
  title: string;
  description?: string;
  image: string;
  category: ProductCategory;
  price: number;
}
```

Хранение массива товаров
```
interface IItemsData {
  items: IItem[];
  preview: string | null;
}
```

Данные заказа
```
interface IOrder {
  payment: PaymentMethod;
  address: string;
  email: string;
  phone: string;
  items: IItem[]; 
  total: number;
}
```

Данные заказа в форме доставки
```
type TDeliveryForm = Pick<IOrder, 'payment' | 'address'>;
```

Данные заказа в форме с данными покупателя
```
type TContactForm = Pick<IOrder, 'email' | 'phone'>;
```

Данные успешной покупки
```
interface IOrderSuccess {
  id: string;
  total: number;
}
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой данных, отвечает за хранение и изменение данных,
- слой представления, отвечает за отображение данных на странице, 
- презентер, отвечает за связь представления и данных.


## Описание базовых классов

1. Класс ` Api ` — cодержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.\
Методы get, post и handleResponse (обработчик ответа от сервера).

2. Класс `EventEmitter` — брокер событий реализует паттерн «Наблюдатель» и позволяет подписываться на события и уведомлять подписчиков о наступлении события. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.\
Методы on, off, emit — для подписки на событие, отписки от события и уведомления подписчиков о наступлении события.\
Методы onAll и offAll — для подписки на все события и сброса всех подписчиков.\
Метод trigger — генерирует заданное событие при вызове.

3. Класс `Component` — абстрактный класс. Конструктор принимает контейнер (HTML элемент), и возвращает корневой DOM-элемент методом render. Имеет сеттеры для установки содержимого.

4. Класс `Model` — абстрактный класс. Содержит метод, сообщающий, что модель изменилась.
Это класс-родитель для класса AppState.


## Слой данных Data

### 1. Класс ```ItemsData```
Класс отвечает за хранение массива товаров, полученных с сервера, и хранение айди открытой карточки товара.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- items: IItem[] - массив объектов товаров
- preview: string | null - id товара, выбранного для просмотра в модальном окне
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Методы:
- getItem(itemId: string): IItem - возвращает товар по id


### 2. Класс ```OrderData```
Класс отвечает за хранение массива товаров, добавленных в корзину, данных покупателя и оформления покупки.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- id: string - айди заказа
- items: IItem[] - массив товаров в корзине
- total: number - суммарная стоимость товаров в корзине
- payment: PaymentMethod - способ оплаты
- address: string - адрес доставки
- email: string - имэил покупателя
- phone: string - телефон покупателя
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Методы: 
- добавление товара в корзину
- удаление товара из корзины
- подсчет и обновление суммарной стоимости товаров
- сеттеры для сохранения данных покупателя
- проверка введенных данных на валидность


## Слой отображения View

### 1. Родительский класс ```Modal``` 
Устанавливает контент в модальное окно, имеет методы open, close, render. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа. \
Конструктор класса принимает инстант брокера событий.

### 2. Родительский класс ```Form``` 
Родительский класс, реализующий форму.
Содержит кнопку отправки данных, элемент формы, элементы для вывода ошибок валидации под полями формы. \
При сабмите инициирует событие передавая в него объект с данными из полей ввода формы. Предоставляет методы для отображения ошибок и управления активностью кнопки "Далее".

### 3. Родительский класс ```Card``` 
Отвечает за отображение карточки товара. В конструктор класса передается DOM элемент темплейта, возвращает карточки разных вариантов верстки.\
Класс используется для отображения карточек на главной странице сайта, в модальном окне с подробным описанием товара, в корзине.\
Поля класса содержат элементы разметки элементов карточки. Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий.\

### 4. Класс ```Page``` 
Отображает массив товаров и счетчик корзины.\
Конструктор класса принимает инстант брокера событий для инициации событий при нажатии пользователем на иконку корзины или карточку товара.

### 5. Класс ```BasketView``` 
Отображает корзину - список товаров, суммарную стоимость.
- кнопка удаления товара из корзины
- кнопка оформления заказа

### 6. Класс ```DeliveryForm``` 
Расширует класс ```Form```. Отображает форму с выбором способа оплаты и заполнением адреса доставки.

### 7. Класс ```ContactForm``` 
Расширует класс ```Form```. Отображает форму с полями для ввода данных покупателя.

### 8. Класс ```OrderSuccess```
Отображает сообщение об успешной покупке и сумму покупки.


## Слой коммуникации

### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
1. События изменения данных (генерируются классами моделями данных)
- `items:changed` - изменение массива товаров (загрузка с сервера)
- `card:selected` - изменение открываемой в модальном окне карточки товара
- `card:previewClear` - необходима очистка данных выбранной для показа в модальном окне карточки товара

2. События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)
- `card:select` - выбор карточки товара для отображения в модальном окне
- `item:add` - добавления товара в корзину
- `item:delete` - удаление товара из корзины
- `basket:open` - открытие корзины
- `basket:submit` - переход к оформлению списка покупок
- `payment:select` - выбор способа оплаты
- `edit-adress:input` - изменение адреса в форме доставки 
- `delivery-form:submit` - сохранение данных оплаты и доставки в модальном окне
- `edit-userinfo:input` - изменение данных покупателя(имейл и телефон) в модальном окне
- `edit-userinfo:submit` - сохранение данных покупателя (имейл и телефон) в модальном окне
- `order-success:submit` - сохранение данных успешной покупки
- `edit-adress:validation` - событие, сообщающее о необходимости валидации адреса покупателя
- `edit-userinfo:validation` - событие, сообщающее о необходимости валидации формы с данными покупателя